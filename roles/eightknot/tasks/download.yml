

- name: Prepare location for 8Knot sources
  ansible.builtin.file:
    path: /opt/git/8Knot
    state: directory
    mode: '0755'
    owner: "{{ ansible_user }}"
  become: true

- name: Clone the 8Knot repository
  git:
    repo: https://github.com/oss-aspen/8Knot
    dest: /opt/git/8Knot
    clone: yes
    update: yes
    single_branch: yes
    version: main

- name: Patch the 8Knot repository
  ansible.posix.patch:
    src: ../patches/8knot/proxyfix.patch
    remote_src: false
    dest: /opt/git/8Knot/8Knot/app.py

